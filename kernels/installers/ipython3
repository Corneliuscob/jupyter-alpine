#!/bin/bash -e

if [ "$(which `basename $0`)" = "$0" ]; then
  echo "Installing ipython3 ..."
  min-apk gallery-python3-kernel

  # Ensure user site-packages directory exists for sys.path 
  mkdir -p `python3 -m site --user-site`

  # TODO: workaround for https://github.com/nbgallery/ipydeps/issues/7
  sed -i 's/packages = set(packages)/#packages = set(packages)/' /usr/lib/python3*/site-packages/ipydeps/__init__.py
fi

  # TODO: temporary patch until fixed upstream https://github.com/ipython/ipywidgets/pull/713
  sed -i 's/new_notification_widget/widget/' /usr/share/jupyter/nbextensions/jupyter-js-widgets/extension.js

hash -r
if [ "$(which `basename $0`)" = "$0" ]; then
  echo "Installation failed!"
  exit
fi

$(basename $0) $@
